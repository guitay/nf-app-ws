<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="MPAS_LOG">
	
	<insert id="MPAS_LOG_insertLog" parameterClass="com.tiancom.mpas.pojo.M_RZB" >
		<isNotEmpty property="db">
    		<![CDATA[/**!mycat:datanode=$db$**/]]>
		</isNotEmpty>
		insert into M_RZB (yhbs, tjrq,hydh,hymc, fslb, rzzt, rzsj, rzms) values ('$yhbs$', $tjrq$,'$hydh$','$hymc$', '$fslb$', '$rzzt$', NULL, '$rzms$' )
	</insert>
	
	<!-- 根据发送类别 日志状态 银行标识 取得日志 -->
	<!-- <isNotEmpty property="yhbs">
			INNER JOIN SJBC_XTCS_$yhbs$ XTCS ON XTCS.CSZ=M.TJRQ
    </isNotEmpty> 查询用来过滤统计日期的，暂时不用
    XTCS.CSMC='SJRQ' and
     -->
	<select id="mpas_selectKhrzByPara"  resultClass="com.tiancom.mpas.pojo.M_RZB"  parameterClass="java.util.HashMap">
		<isNotEmpty property="db">
    		<![CDATA[/**!mycat:datanode=$db$**/]]>
		</isNotEmpty> 
		Select (@rowNum:=@rowNum+1) AS rowNo , a .* FROM 
		(SELECT M.rzid rzid,M.yhbs yhbs,M.tjrq tjrq,M.hydh hydh,M.hymc hymc,FSLB.DMMS fslb, RZZT.DMMS rzzt,M.rzsj rzsj,M.rzms rzms
		FROM M_RZB  M
		INNER JOIN M_CSB_DMMS FSLB ON FSLB.DMZ=M.FSLB AND UPPER(FSLB.DMMC) = 'FSLB'
		INNER JOIN M_CSB_DMMS RZZT ON RZZT.DMZ=M.RZZT AND UPPER(RZZT.DMMC) = 'RZZT'
		
		where 1=1
		<isNotEmpty property="yhbs" prepend="and">
			 M.YHBS='$yhbs$'
		</isNotEmpty>
		<isNotEmpty property="fslb" prepend="and">
			M.FSLB='$fslb$'
		</isNotEmpty>
	    <isNotEmpty property="rzzt" prepend="and">
			M.RZZT ='$rzzt$'
		</isNotEmpty>
		ORDER BY M.rzsj DESC)a,
		(SELECT (@rowNum :=$beginRow$) ) b 
	</select>
	<!-- 
	<isNotEmpty property="yhbs">
			INNER JOIN SJBC_XTCS_$yhbs$ XTCS ON XTCS.CSZ=M.TJRQ
		</isNotEmpty> 查询用来限制统计日期的，暂时不用
     -->
	<select id="mpas_selectCountKhrzByPara"  resultClass="java.lang.Integer"  parameterClass="java.util.HashMap">
		<isNotEmpty property="db">
    		<![CDATA[/**!mycat:datanode=$db$**/]]>
		</isNotEmpty> 
	    SELECT COUNT(1) 
		from M_RZB  M 		
		where 1=1
		<isNotEmpty property="yhbs" prepend="and">
			M.YHBS='$yhbs$'
		</isNotEmpty>
		<isNotEmpty property="fslb" prepend="and">
			M.FSLB='$fslb$'
		</isNotEmpty>
	    <isNotEmpty property="rzzt" prepend="and">
			M.RZZT ='$rzzt$'
		</isNotEmpty>
	</select>
	<!-- YHBS INIT -->
	<select id="mpas_selectAllYhbs"  resultClass="com.tiancom.mpas.pojo.M_KHB" parameterClass="java.util.HashMap">
		<isNotEmpty property="db">
    		<![CDATA[/**!mycat:datanode=$db$**/]]>
		</isNotEmpty> 
	    SELECT KH.YHBS,KH.YHMC,KH.YHFL,KH.sftsdx,KH.sftsyj,KH.zcrq FROM M_KHB KH WHERE KH.YHBS!='TCCP' 
	</select>
	
	<!-- DMMS INIT -->
	<select id="mpas_selectDMMSByDmmc"  resultClass="com.tiancom.mpas.pojo.M_CSBDmms" parameterClass="java.util.HashMap">
		<isNotEmpty property="db">
    		<![CDATA[/**!mycat:datanode=$db$**/]]>
		</isNotEmpty> 
	    SELECT DMMS.DMMC,DMMS.DMZ,DMMS.DMMS FROM M_CSB_DMMS DMMS WHERE UPPER(DMMS.DMMC) = '$dmmc$'
	</select>
</sqlMap>
